<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Player</title>
    <!-- Tailwind Offline CSS, Local Copy (In case of CDN failures) -->
    <link rel="stylesheet" href="css/all-tailwind-classes-full-min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Library untuk membaca metadata audio -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsmediatags/3.9.5/jsmediatags.min.js"></script>
    <style>
        /* CSS Variabel untuk Theming */
        :root {
            --font-family: 'Inter', sans-serif;
            --window-bg: #f0f0f0;
            --window-text: #000;
            --window-border: #a0a0a0;
            --control-hover-bg: #e6e6e6;
            --control-close-hover-bg: #e81123;
            --control-close-hover-text: white;
            --progress-bar-bg: #e2e8f0;
            --progress-color: #f97316;
            --controls-bg: rgba(0, 0, 0, 0.05);
            --eq-track-bg: #cbd5e1; /* Tailwind slate-300 */
            --eq-thumb-color: #f97316; /* Tailwind orange-600 */
            --eq-text: #475569; /* Tailwind slate-600 */

            /* Variabel untuk efek Liquid Glass */
            --c-glass: #f0f0f0;
            --c-light: #ffffff;
            --c-dark: #000000;
            --glass-reflex-dark: 1;
            --glass-reflex-light: 1;
            --saturation: 150%;
        }

        body.dark {
            --window-bg: #2b2b2b;
            --window-text: #f0f0f0;
            --window-border: #555555;
            --control-hover-bg: #3c3c3c;
            --progress-bar-bg: #4b5563;
            --controls-bg: rgba(255, 255, 255, 0.1);
            --eq-track-bg: #475569; /* Tailwind slate-700 */
            --eq-thumb-color: #fb923c; /* Tailwind orange-400 */
            --eq-text: #cbd5e1; /* Tailwind slate-300 */

            /* Variabel Liquid Glass - Mode Gelap */
            --c-glass: #2b2b2b;
            --glass-reflex-dark: 2;
            --glass-reflex-light: 0.3;
        }

        html,
        body {
            margin: 0;
            padding: 0;
            background-color: transparent;
            font-family: var(--font-family);
            color: var(--window-text);
            overflow: hidden;
            user-select: none;
        }

        /* --- Window Style --- */
        .app-window {
            display: flex;
            flex-direction: column;
            width: 100vw;
            height: 100vh;
            border: 1px solid var(--window-border);
            border-radius: 8px;
            background-color: var(--window-bg);
            transition: background-color 0.3s, box-shadow 0.3s;
            position: relative;
            overflow: hidden;
        }

        body.fancy-mode .app-window {
            background-color: color-mix(in srgb, var(--c-glass) 15%, transparent);
            backdrop-filter: blur(8px) url(#liquid-glass-filter) saturate(var(--saturation));
            -webkit-backdrop-filter: blur(8px) url(#liquid-glass-filter) saturate(var(--saturation));
            box-shadow:
                inset 0 0 0 1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 10%), transparent),
                inset 1.8px 3px 0px -2px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 90%), transparent),
                inset -2px -2px 0px -2px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 80%), transparent),
                inset -3px -8px 1px -6px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 60%), transparent),
                inset -0.3px -1px 4px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 12%), transparent),
                inset -1.5px 2.5px 0px -2px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 20%), transparent),
                inset 0px 3px 4px -2px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 20%), transparent),
                inset 2px -6.5px 1px -4px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 10%), transparent),
                0px 1px 5px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 10%), transparent),
                0px 6px 16px 0px color-mix(in srgb, var(--c-dark) calc(var(--glass-reflex-dark) * 8%), transparent);
        }

        .window-header {
            /* PENTING: Dibuat absolute dan Z-index tinggi */
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            z-index: 10; /* Pastikan di atas semua konten utama */
            
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
            flex-shrink: 0;
            padding: 3px 3px 3px 6px;
            
            /* Background transparan agar konten di bawah header terlihat, tapi tetap bisa di drag */
            background-color: transparent; 
        }
        
        /* Wrapper untuk konten utama di bawah header */
        .content-wrapper {
            position: absolute;
            top: 35px; /* Sesuaikan dengan tinggi header (approx 35px) */
            bottom: 0;
            left: 0;
            right: 0;
            overflow: auto;
            display: flex; /* Untuk menampung player dan eq container */
        }


        .window-title-container {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        h2 {
            font-weight: 400;
            font-size: 13px;
        }

        .window-controls {
            display: flex;
        }

        .window-control-btn {
            width: 45px;
            height: 29px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            color: var(--window-text);
            padding: 0; /* Pastikan padding diatur ulang agar tombol seragam */
        }

        .window-control-btn:hover {
            background-color: var(--control-hover-bg);
        }

        /* PERBAIKAN: Gaya Tombol Tutup agar sama dengan referensi */
        .close-window-btn {
            font-size: 16px; /* Gunakan ukuran font yang lebih kecil dan seragam */
            font-weight: 500; /* Font weight seragam */
            line-height: 29px; /* Sesuaikan line-height dengan tinggi tombol */
            padding-bottom: 0; /* Hapus padding-bottom */
        }
        /* Menggunakan SVG untuk simbol 'X' agar lebih seragam */
        .close-window-btn svg {
            width: 10px;
            height: 10px;
        }
        /* PERBAIKAN: Hover tombol tutup */
        .close-window-btn:hover {
            background-color: var(--control-close-hover-bg);
            color: var(--control-close-hover-text);
        }

        /* Container Utama Player (Fade Transition) */
        #music-player-container {
            flex-grow: 1;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            opacity: 1;
            transition: opacity 0.3s ease-out;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* Container Equalizer (Fade Transition) */
        #equalizer-container {
            flex-grow: 1;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            opacity: 0;
            pointer-events: none; 
            transition: opacity 0.3s ease-out;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* Aturan tampilan saat aktif */
        .show-view {
            opacity: 1 !important;
            pointer-events: auto !important;
        }

        .hide-view {
            opacity: 0 !important;
            pointer-events: none !important;
        }


        /* --- Gaya Slider Progres/Volume Baru --- */
        .slider-container {
            position: relative;
            width: 100%;
            height: 8px;
            background: var(--progress-bar-bg);
            border-radius: 999px;
            cursor: pointer;
            margin: 8px 0;
        }

        .slider-progress {
            position: absolute;
            height: 100%;
            background: var(--progress-color);
            border-radius: 999px;
            width: 0%;
            z-index: 1;
        }

        .slider-thumb-glass {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 20px;
            border-radius: 999px;
            cursor: grab;
            z-index: 2;
            background-color: var(--window-bg);
            box-shadow: 0 1px 8px 0 rgba(0, 30, 63, 0.1), 0 0 2px 0 rgba(0, 9, 20, 0.1);
            transition: transform 0.15s ease, background-color 0.2s, box-shadow 0.2s, backdrop-filter 0.2s;
        }

        /* Ukuran spesifik untuk handle volume agar lebih kecil */
        #volume-thumb.slider-thumb-glass {
            width: 16px;
            height: 16px;
        }

        .slider-thumb-glass:active {
            cursor: grabbing;
        }

        body.dark .slider-thumb-glass {
            box-shadow: 0 1px 8px 0 rgba(0, 0, 0, 0.2), 0 0 2px 0 rgba(0, 0, 0, 0.2);
        }

        .slider-thumb-glass.active {
            background-color: color-mix(in srgb, var(--window-text) 5%, var(--window-bg));
            box-shadow: none;
        }

        body.fancy-mode .slider-thumb-glass.active {
            background-color: color-mix(in srgb, var(--c-glass) 40%, transparent);
            backdrop-filter: blur(6px);
            -webkit-backdrop-filter: blur(6px);
            box-shadow: inset 0 0 0 1px color-mix(in srgb, var(--c-light) calc(var(--glass-reflex-light) * 20%), transparent);
        }

        .slider-thumb-glass:active {
            transform: translate(-50%, -50%) scaleY(0.98) scaleX(1.1);
        }

        /* --- Gaya Kontrol Player Baru --- */
        .controls-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--controls-bg);
            border-radius: 12px;
            padding: 8px 16px;
            margin-top: 1rem;
        }

        .control-button {
            background: transparent;
            border: none;
            color: var(--window-text);
            opacity: 0.8;
            cursor: pointer;
            transition: opacity 0.2s, transform 0.1s ease-out;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            line-height: 1;
        }

        .control-button:hover {
            opacity: 1;
        }

        .control-button:active {
            transform: scale(0.9);
        }

        #play-pause-btn #play-icon {
            padding-left: 4px;
        }

        /* Gaya lain-lain */
        .drag-over {
            background-color: rgba(0, 0, 0, 0.1);
        }

        body.dark .drag-over {
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* --- Gaya Equalizer Vertikal (Diambil dari contoh) --- */
        .eq-slider-wrapper {
            width: 1.5rem;
            height: 10rem;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        .eq-slider-rotated {
            -webkit-appearance: none; 
            appearance: none;
            width: 10rem; 
            height: 0.5rem; 
            transform: rotate(-90deg);
            background-color: var(--eq-track-bg);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
            margin: 0;
        }

        /* Styling untuk 'thumb' (bulatan slider) di Chrome/Safari */
        .eq-slider-rotated::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 1.2rem; 
            height: 1.2rem;
            background: var(--eq-thumb-color);
            border: 2px solid var(--window-bg);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }
        
        /* Styling untuk 'thumb' di Firefox */
        .eq-slider-rotated::-moz-range-thumb {
            width: 1.2rem; 
            height: 1.2rem;
            background: var(--eq-thumb-color);
            border: 2px solid var(--window-bg);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }

        /* Styling untuk 'track' di Firefox */
        .eq-slider-rotated::-moz-range-track {
            background: var(--eq-track-bg);
            border-radius: 0.5rem;
        }

        .eq-slider-rotated:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .freq-label {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--eq-text);
            margin-top: 5px;
        }
        .value-label {
            font-size: 0.7rem;
            font-weight: bold;
            color: var(--window-text);
            margin-bottom: 5px;
        }
        .eq-box-outer {
            background-color: var(--controls-bg);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-top: 1rem;
        }
        /* PERBAIKAN: Gaya Tombol Tutup di EQ agar seragam (class .window-control-btn sudah mengatur ukuran) */
        #close-eq-btn-icon {
            width: 10px;
            height: 10px;
        }

        /* --- CSS OVERRIDE KHUSUS UNTUK MEMPERBAIKI MASALAH TEMA TERANG EQ CONTROLS --- */
        /* Memastikan warna terang pada dropdown dan tombol Reset ketika body TIDAK memiliki class 'dark' */
        body:not(.dark) .eq-preset-control-light {
            background-color: #ffffff !important; /* Putih bersih */
            color: #1f2937 !important; /* Text gelap (gray-800) */
            border-color: #d1d5db !important; /* Border abu-abu terang (gray-300) */
        }
        
        /* Mengatur tombol reset sedikit lebih gelap dari dropdown (gray-200) */
        body:not(.dark) #reset-eq-btn.eq-preset-control-light {
            background-color: #e5e7eb !important; /* Abu-abu sangat terang (gray-200) */
        }
        /* Mengatur hover tombol reset di mode terang */
        body:not(.dark) #reset-eq-btn.eq-preset-control-light:hover {
            background-color: #d1d5db !important; /* Abu-abu terang saat hover (gray-300) */
        }
        /* ----------------------------------------------------------------------------- */
    </style>
</head>

<body>
    <!-- Filter SVG untuk efek Liquid Glass -->
    <div style="position: absolute; width: 0; height: 0; z-index: -1;">
        <svg>
            <filter id="liquid-glass-filter" primitiveUnits="objectBoundingBox">
                <feImage result="map" width="100%" height="100%" x="0" y="0" preserveAspectRatio="none"
                    href="img/svg-filter.jpg" />
                <feGaussianBlur in="SourceGraphic" stdDeviation="0.00" result="blur" />
                <feDisplacementMap id="disp" in="blur" in2="map" scale="0.4" xChannelSelector="R" yChannelSelector="G">
                </feDisplacementMap>
            </filter>
        </svg>
    </div>

    <!-- Audio Player utama (TETAP) -->
    <audio id="audio-player" class="hidden"></audio>

    <div class="app-window">
        <!-- Header (DIPOSISI ABSOLUT DI ATAS SEMUA KONTEN) -->
        <div id="music-window-header" class="window-header">
            <div class="window-title-container">
                <img src="https://img.icons8.com/fluency/48/000000/apple-music.png" alt="Music Icon" class="h-4 w-4">
                <h2 id="window-main-title">Music Player</h2>
            </div>
            <div class="window-controls">
                <button id="minimize-btn" class="window-control-btn" title="Minimize">
                    <svg width="10" height="2" viewBox="0 0 10 2" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0 1H10V2H0V1Z" fill="currentColor" />
                    </svg>
                </button>
                <button id="maximize-btn" class="window-control-btn" title="Maximize">
                    <svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 1V9H1V1H9ZM10 0H0V10H10V0Z" fill="currentColor" />
                    </svg>
                </button>
                <!-- PERBAIKAN: Menggunakan SVG untuk simbol 'X' agar seragam -->
                <button id="close-btn" class="window-control-btn close-window-btn" title="Close">
                    <svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M1 1L9 9M9 1L1 9"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- CONTENT WRAPPER BARU -->
        <div class="content-wrapper">
            <!-- CONTAINER UTAMA PLAYER (diberi ID baru untuk transisi) -->
            <div id="music-player-container" class="show-view" ondrop="handleDrop(event)">
                <div id="album-art-container"
                    class="w-48 h-48 rounded-lg mb-4 mx-auto flex items-center justify-center text-center text-slate-500 dark:text-slate-400 text-sm p-4">
                    <img id="album-art" class="w-full h-full rounded-lg object-cover hidden" alt="Album Art">
                    <div id="album-art-placeholder" class="flex flex-col items-center">
                        <svg xmlns="http://www.w3.org/2000/svg"
                            class="h-16 w-16 mx-auto text-slate-400 dark:text-slate-500 mb-2" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2z">
                            </path>
                        </svg>
                        No Song Loaded
                    </div>
                </div>

                <!-- Struktur Slider Progres -->
                <div class="w-full mb-3">
                    <div class="slider-container" id="progress-slider-container">
                        <div class="slider-progress" id="progress-track"></div>
                        <div class="slider-thumb-glass" id="progress-thumb">
                        </div>
                    </div>
                    <div class="w-full flex justify-between text-xs opacity-60 mt-2">
                        <span id="current-time">0:00</span>
                        <span id="duration">0:00</span>
                    </div>
                </div>

                <div class="text-left mb-4">
                    <h3 id="song-title" class="text-xl font-bold truncate">No song playing</h3>
                    <p id="song-artist" class="text-sm opacity-70 truncate">Drop a music file to start</p>
                </div>

                <!-- KONTROL PEMUTAR BARU -->
                <div class="controls-container">
                    <!-- Tombol Equalizer -->
                    <button id="eq-btn" class="control-button text-xl p-2 rounded-full hover:bg-white/10" title="Equalizer">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="20" x2="18" y2="10"></line>
                            <line x1="12" y1="20" x2="12" y2="4"></line>
                            <line x1="6" y1="20" x2="6" y2="14"></line>
                        </svg>
                    </button>

                    <button id="stop-btn" class="control-button" title="Stop"><svg xmlns="http://www.w3.org/2000/svg"
                            width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M6 6h12v12H6z" />
                        </svg></button>

                    <div class="flex items-center justify-center gap-x-4">
                        <!-- Tombol Mundur/Lagu Sebelumnya -->
                        <button id="rewind-btn" class="control-button" title="Rewind 10s">
                            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"
                                fill="currentColor">
                                <path d="M6 6h2v12H6zm3.5 6 8.5 6V6z" />
                            </svg>
                        </button>

                        <!-- Tombol Putar/Jeda -->
                        <button id="play-pause-btn" class="control-button" title="Play/Pause">
                            <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" width="40" height="40"
                                viewBox="0 0 24 24" fill="currentColor">
                                <path d="M8 5v14l11-7z" />
                            </svg>
                            <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" width="40" height="40"
                                viewBox="0 0 24 24" fill="currentColor" style="display: none;">
                                <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
                            </svg>
                        </button>

                        <!-- Tombol Maju/Lagu Berikutnya -->
                        <button id="forward-btn" class="control-button" title="Forward 10s">
                            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"
                                fill="currentColor">
                                <path d="M16 6h2v12h-2zm-4.5 6L6 6v12z" />
                            </svg>
                        </button>
                    </div>

                    <!-- KONTROL VOLUME BARU -->
                    <div class="flex items-center gap-x-2 w-24">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                            fill="currentColor" class="opacity-80">
                            <path
                                d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z" />
                        </svg>
                        <div class="slider-container my-0" id="volume-slider-container">
                            <div class="slider-progress" id="volume-track"></div>
                            <div class="slider-thumb-glass" id="volume-thumb"></div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- CONTAINER EQUALIZER BARU -->
            <div id="equalizer-container" class="hide-view">
                <div class="flex justify-between items-center mb-4 px-2">
                    <h3 class="text-xl font-bold">Equalizer 10-Band</h3>
                    <!-- PERBAIKAN: Menggunakan kelas dan SVG yang sama dengan tombol tutup window -->
                    <button id="close-eq-btn" class="window-control-btn close-window-btn" title="Kembali ke Pemutar">
                        <svg id="close-eq-btn-icon" width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M1 1L9 9M9 1L1 9"/>
                        </svg>
                    </button>
                </div>

                <!-- KONTROL EQ ON/OFF DAN PRESET -->
                <div class="flex flex-col sm:flex-row items-center justify-between mb-3 px-2">
                    <!-- Checkbox Aktifkan EQ -->
                    <div class="flex items-center mb-2 sm:mb-0 mr-4">
                        <input type="checkbox" id="eq-enabled-toggle" class="h-4 w-4 rounded border-gray-300 text-orange-600 focus:ring-orange-500 mr-2" checked>
                        <label for="eq-enabled-toggle" class="text-sm font-medium">Aktifkan EQ</label>
                    </div>

                    <!-- Kontrol Preset -->
                    <div id="preset-controls" class="flex items-center flex-grow">
                        <label for="preset-select" class="text-sm opacity-70 whitespace-nowrap mr-2">Preset:</label>
                        <!-- PENTING: Menambahkan kelas eq-preset-control-light dan mengatur kelas dark: -->
                        <select id="preset-select" class="eq-preset-control-light dark:bg-gray-700 dark:text-white border border-gray-300 dark:border-gray-600 text-sm rounded-lg p-1 shadow-sm flex-grow mr-2" style="min-width: 150px;">
                            <!-- Opsi diisi oleh JS -->
                        </select>
                        <!-- PENTING: Menambahkan kelas eq-preset-control-light dan mengatur kelas dark: -->
                        <button id="reset-eq-btn" class="text-sm font-semibold py-1 px-3 rounded-full eq-preset-control-light dark:bg-gray-600 dark:text-white hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors">
                            Reset
                        </button>
                    </div>
                </div>

                <!-- Kontainer Slider Equalizer -->
                <div id="eq-box" class="eq-box-outer flex-grow flex justify-center items-stretch overflow-x-auto p-4">
                    <div id="eq-sliders-container" class="flex justify-around items-center h-full w-full max-w-lg">
                        <!-- 10 Band EQ akan dibuat oleh JavaScript di sini -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Elemen DOM
        const header = document.getElementById('music-window-header');
        const closeBtn = document.getElementById('close-btn');
        const minimizeBtn = document.getElementById('minimize-btn');
        const maximizeBtn = document.getElementById('maximize-btn');
        const musicPlayerContainer = document.getElementById('music-player-container'); // Player Utama
        const equalizerContainer = document.getElementById('equalizer-container'); // EQ Container
        const eqBtn = document.getElementById('eq-btn'); // Tombol EQ di Player
        const closeEqBtn = document.getElementById('close-eq-btn'); // Tombol X di EQ
        const windowMainTitle = document.getElementById('window-main-title'); // Judul Utama

        const audioPlayer = document.getElementById('audio-player');
        const albumArt = document.getElementById('album-art');
        const albumArtPlaceholder = document.getElementById('album-art-placeholder');
        const songTitle = document.getElementById('song-title');
        const songArtist = document.getElementById('song-artist');
        const currentTimeEl = document.getElementById('current-time');
        const durationEl = document.getElementById('duration');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const playIcon = document.getElementById('play-icon');
        const pauseIcon = document.getElementById('pause-icon');
        const rewindBtn = document.getElementById('rewind-btn');
        const forwardBtn = document.getElementById('forward-btn');
        const stopBtn = document.getElementById('stop-btn');

        // Elemen Slider Progres
        const progressBarContainer = document.getElementById('progress-slider-container');
        const progressTrack = document.getElementById('progress-track');
        const progressThumb = document.getElementById('progress-thumb');

        // Elemen Slider Volume
        const volumeSliderContainer = document.getElementById('volume-slider-container');
        const volumeTrack = document.getElementById('volume-track');
        const volumeThumb = document.getElementById('volume-thumb');

        // Elemen EQ
        const eqSlidersContainer = document.getElementById('eq-sliders-container');
        const presetSelect = document.getElementById('preset-select');
        const resetBtn = document.getElementById('reset-eq-btn');
        const eqEnabledToggle = document.getElementById('eq-enabled-toggle');

        // Variabel state
        let isWindowDragging = false;
        let isAudioSetup = false;
        let currentAlbumArtUrl = null;

        // --- Variabel Web Audio API untuk Equalizer (DIAMBIL DARI CONTOH) ---
        let audioContext;
        let source; // source node dari createMediaElementSource
        let analyser;
        let dataArray;
        let bufferLength;
        let gainNode; // Node Gain global sebelum destination
        const filters = [];
        let lastGains = new Array(10).fill(0);
        const frequencies = [32, 64, 125, 250, 500, 1000, 2000, 4000, 8000, 16000];

        // --- Definisi Preset EQ ---
        const eqPresets = {
            'flat': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'bass_boost': [5.0, 4.0, 3.0, 2.0, 1.0, 0, -1.0, -2.0, -3.0, -4.0],
            'treble_boost': [-4.0, -3.0, -2.0, -1.0, 0, 1.0, 2.0, 3.0, 4.0, 5.0],
            'vocal': [-3.0, -2.0, 0, 2.0, 4.0, 5.0, 4.0, 2.0, 0, -2.0],
            'rock': [5.0, 4.0, -2.0, 0, 2.0, 4.0, 3.0, 4.0, 5.0, 5.0],
            'pop': [-2.0, 0, 2.0, 4.0, 2.0, 0, -2.0, -4.0, -2.0, 0],
            'dance': [4.0, 5.0, 3.0, 0, -2.0, -4.0, -3.0, 0, 3.0, 5.0],
        };

        const presetNames = {
            'flat': 'Flat (Default)',
            'bass_boost': 'Peningkatan Bass',
            'treble_boost': 'Peningkatan Treble',
            'vocal': 'Vokal',
            'rock': 'Rock',
            'pop': 'Pop',
            'dance': 'Dance/Club',
        };

        // --- FUNGSI EQ ---

        function initAudioContextAndEQ() {
            if (isAudioSetup) return;

            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Analyser untuk visualisasi (tetap digunakan)
                analyser = audioContext.createAnalyser();
                analyser.fftSize = 256;
                bufferLength = analyser.frequencyBinCount;
                dataArray = new Uint8Array(bufferLength);

                // Source dari elemen <audio>
                source = audioContext.createMediaElementSource(audioPlayer);
                
                gainNode = audioContext.createGain(); // Node Gain global sebelum destination
                
                let previousNode = source;
                filters.length = 0; // Pastikan array filters kosong sebelum diisi

                // Buat rantai filter EQ
                frequencies.forEach((freq, i) => {
                    const filter = audioContext.createBiquadFilter();
                    filter.type = 'peaking';
                    filter.frequency.value = freq;
                    filter.Q.value = 1.414;
                    filter.gain.value = 0; // Mulai dengan flat
                    
                    filters.push(filter);
                    
                    if (previousNode) {
                        previousNode.connect(filter);
                    }
                    previousNode = filter;
                });
                
                if (filters.length > 0) {
                    // Hubungkan rantai filter terakhir ke analyser
                    filters[filters.length - 1].connect(analyser);
                } else {
                    // Jika gagal buat filter, hubungkan source langsung ke analyser
                    source.connect(analyser);
                }
                
                // Hubungkan analyser ke master gain
                analyser.connect(gainNode);

                // Hubungkan master gain ke output
                gainNode.connect(audioContext.destination);

                isAudioSetup = true;
                console.log("[EQ] Web Audio API dan EQ berhasil diinisialisasi.");

            } catch (e) {
                console.error("[EQ] Error saat menginisialisasi Web Audio API atau EQ:", e);
            }
        }

        // Fungsi untuk mengaplikasikan gain ke filter dan slider
        function applyGain(gains, updateSliders = true) {
            if (gains.length !== filters.length || filters.length === 0) return;

            gains.forEach((gainValue, i) => {
                const safeGain = Math.max(-20, Math.min(20, gainValue));
                const slider = document.getElementById(`slider-${i}`);
                const valueLabel = document.getElementById(`val-${i}`);

                if (filters[i] && audioContext) {
                    filters[i].gain.value = safeGain;
                }
                if (updateSliders && slider) {
                    slider.value = safeGain;
                }
                if (updateSliders && valueLabel) {
                    valueLabel.textContent = `${safeGain.toFixed(1)}dB`;
                }
            });
        }
        
        // Mengambil nilai gain dari slider saat ini
        function getCurrentSliderGains() {
            const currentGains = [];
            frequencies.forEach((_, i) => {
                const slider = document.getElementById(`slider-${i}`);
                if (slider) {
                    currentGains.push(parseFloat(slider.value));
                } else {
                    currentGains.push(0);
                }
            });
            return currentGains;
        }

        // Mengaktifkan/Menonaktifkan EQ (secara virtual dengan set gain ke 0)
        function toggleEQ() {
            const isEnabled = eqEnabledToggle.checked;
            
            // Nonaktifkan/Aktifkan UI slider dan kontrol
            document.querySelectorAll('.eq-slider-rotated').forEach(s => s.disabled = !isEnabled);
            presetSelect.disabled = !isEnabled;
            resetBtn.disabled = !isEnabled;

            if (isEnabled) {
                // EQ Diaktifkan: Kembalikan gain dari nilai slider yang terakhir disimpan
                const currentSliderGains = getCurrentSliderGains();
                applyGain(currentSliderGains, false); // Terapkan gain ke filter tanpa menggerakkan slider (karena slider sudah di posisi benar)
                lastGains = currentSliderGains; 
                
            } else {
                // EQ Dinonaktifkan: Simpan status gain slider saat ini sebelum di-reset ke 0
                lastGains = getCurrentSliderGains();

                // Reset semua filter gain ke 0dB
                applyGain(new Array(10).fill(0), false); // Reset filter gain ke 0dB
            }
        }


        // Inisialisasi UI EQ & Preset Selector
        function initEQUI() {
            eqSlidersContainer.innerHTML = ''; 

            // 1. Isi Dropdown dari Objek eqPresets
            presetSelect.innerHTML = '';
            for (const [key, name] of Object.entries(presetNames)) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = name;
                presetSelect.appendChild(option);
            }

            // Listener untuk Preset Selector
            presetSelect.addEventListener('change', (e) => {
                const selectedKey = e.target.value;
                const presetValues = eqPresets[selectedKey];
                if (presetValues) {
                    applyGain(presetValues, true); // Update filter DAN slider UI
                }
                if (!eqEnabledToggle.checked) {
                    eqEnabledToggle.checked = true;
                    toggleEQ();
                }
            });

            // Listener untuk tombol Reset (ini akan me-load preset 'flat')
            resetBtn.addEventListener('click', () => {
                presetSelect.value = 'flat';
                applyGain(eqPresets.flat, true);
                if (!eqEnabledToggle.checked) {
                    eqEnabledToggle.checked = true;
                    toggleEQ();
                }
            });
            
            // Listener untuk Toggle EQ
            eqEnabledToggle.addEventListener('change', toggleEQ);

            // 2. Buat Slider EQ
            frequencies.forEach((freq, i) => {
                const bandContainer = document.createElement('div');
                bandContainer.className = 'flex flex-col items-center mx-1'; 
                
                const valueLabel = document.createElement('span');
                valueLabel.id = `val-${i}`;
                valueLabel.className = 'value-label text-xs';
                
                const sliderWrapper = document.createElement('div');
                sliderWrapper.className = 'eq-slider-wrapper'; 

                const slider = document.createElement('input');
                slider.type = 'range';
                slider.id = `slider-${i}`;
                slider.min = -20;
                slider.max = 20;
                slider.value = 0;
                slider.step = 0.5;
                slider.className = 'eq-slider-rotated';
                slider.disabled = !eqEnabledToggle.checked; 
                
                slider.addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    if (filters[i]) {
                        filters[i].gain.value = value;
                        lastGains[i] = value; // Update lastGains saat slider digeser
                    }
                    valueLabel.textContent = `${value.toFixed(1)}dB`;
                    presetSelect.value = 'flat'; 
                });
                
                sliderWrapper.appendChild(slider);

                const freqLabel = document.createElement('span');
                freqLabel.className = 'freq-label text-xs';
                freqLabel.textContent = freq < 1000 ? `${freq}Hz` : `${freq / 1000}k`;

                bandContainer.appendChild(valueLabel); 
                bandContainer.appendChild(sliderWrapper);
                bandContainer.appendChild(freqLabel); 

                eqSlidersContainer.appendChild(bandContainer);
            });
            
            // 3. Terapkan preset flat secara default ke UI
            applyGain(eqPresets.flat, true);
        }

        // --- FUNGSI TRANSISI VIEW BARU ---

        function toggleEQView(showEQ) {
            if (showEQ) {
                // Tampilkan EQ, Sembunyikan Player
                musicPlayerContainer.classList.add('hide-view');
                musicPlayerContainer.classList.remove('show-view');
                equalizerContainer.classList.add('show-view');
                equalizerContainer.classList.remove('hide-view');
                windowMainTitle.textContent = "Equalizer 10-Band";
            } else {
                // Tampilkan Player, Sembunyikan EQ
                equalizerContainer.classList.add('hide-view');
                equalizerContainer.classList.remove('show-view');
                musicPlayerContainer.classList.add('show-view');
                musicPlayerContainer.classList.remove('hide-view');
                windowMainTitle.textContent = "Music Player";
            }
        }

        // --- FUNGSI PLAYER ASLI (Disesuaikan) ---

        function sendVisualizerData() {
            // Hanya kirim jika Player View sedang aktif
            if (musicPlayerContainer.classList.contains('show-view') && !audioPlayer.paused && isAudioSetup) {
                analyser.getByteFrequencyData(dataArray);
                parent.postMessage({
                    action: 'visualizer-data',
                    data: dataArray,
                    bufferLength: Math.floor(bufferLength * 0.66),
                    isPaused: audioPlayer.paused
                }, '*');
            }
            requestAnimationFrame(sendVisualizerData);
        }
        
        // Memulai visualizer di akhir
        requestAnimationFrame(sendVisualizerData);


        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs.toString().padStart(2, '0')}`;
        }

        // music_player.html
        async function playMusic(file) {
            console.log('[Music Player] Starting playMusic for file:', file.name);

            // PENTING: Inisialisasi Audio Context dan EQ di sini
            if (!isAudioSetup) initAudioContextAndEQ();
            if (audioContext.state === 'suspended') audioContext.resume();

            if (currentAlbumArtUrl) { URL.revokeObjectURL(currentAlbumArtUrl); }
            albumArtPlaceholder.style.display = 'none';
            albumArt.style.display = 'block';
            const defaultIcon = "https://img.icons8.com/fluency/96/000000/apple-music.png";
            albumArt.src = defaultIcon;
            const fileURL = URL.createObjectURL(file);
            audioPlayer.src = fileURL; 

            // Ekstrak nama file sebagai fallback
            const fileName = file.name.replace(/\.[^/.]+$/, "");
            let [artist, title] = fileName.split(' - '); 
            if (!title) {
                title = artist;
                artist = 'Unknown Artist';
            }
            songTitle.textContent = title.trim();
            songArtist.textContent = artist.trim();

            const fallbackNotification = {
                action: 'show-media-notification',
                title: title.trim(),
                artist: artist.trim(),
                albumArt: defaultIcon
            };
            parent.postMessage(fallbackNotification, '*');

            audioPlayer.oncanplay = function () {
                const canPlayNotification = {
                    action: 'show-media-notification',
                    title: songTitle.textContent,
                    artist: songArtist.textContent,
                    albumArt: albumArt.src
                };
                parent.postMessage(canPlayNotification, '*');
                audioPlayer.oncanplay = null;
            };

            try {
                await audioPlayer.play();
                console.log('[Music Player] Audio playback started successfully.');
            } catch (e) {
                console.error('[Music Player] Error playing audio:', e);
            }

            let hasReadFinished = false;
            const readTimeout = setTimeout(() => {
                if (!hasReadFinished) {
                    console.error('[Music Player] jsmediatags TIMEOUT. Using filename as metadata.');
                    if (audioPlayer.src) { 
                        const timeoutNotification = {
                            action: 'show-media-notification',
                            title: songTitle.textContent,
                            artist: songArtist.textContent,
                            albumArt: albumArt.src
                        };
                        parent.postMessage(timeoutNotification, '*');
                    }
                }
            }, 1500);

            window.jsmediatags.read(file, {
                onSuccess: function (tag) {
                    hasReadFinished = true;
                    clearTimeout(readTimeout);
                    const tags = tag.tags;
                    const finalTitle = tags.title || title.trim();
                    const finalArtist = tags.artist || artist.trim();
                    songTitle.textContent = finalTitle;
                    songArtist.textContent = finalArtist;

                    let finalAlbumArt = defaultIcon; 
                    const picture = tags.picture;
                    if (picture) {
                        const blob = new Blob([new Uint8Array(picture.data)], { type: picture.format });
                        currentAlbumArtUrl = URL.createObjectURL(blob);
                        albumArt.src = currentAlbumArtUrl;
                        finalAlbumArt = currentAlbumArtUrl;
                    } 

                    audioPlayer.oncanplay = null;
                    const finalNotification = {
                        action: 'show-media-notification',
                        title: finalTitle,
                        artist: finalArtist,
                        albumArt: finalAlbumArt
                    };
                    parent.postMessage(finalNotification, '*');
                },
                onError: function (error) {
                    hasReadFinished = true;
                    clearTimeout(readTimeout);
                    console.error('[Music Player] jsmediatags ERROR reading meta', error.type, error.info);
                    audioPlayer.oncanplay = null;
                    const errorNotification = {
                        action: 'show-media-notification',
                        title: songTitle.textContent,
                        artist: songArtist.textContent,
                        albumArt: albumArt.src
                    };
                    parent.postMessage(errorNotification, '*');
                }
            });
        }

        // Logika Slider Progres (Tidak Berubah)
        let isSliderDragging = false;
        function updateThumbAndProgress(percent) {
            percent = Math.max(0, Math.min(100, percent));
            const sliderWidth = progressBarContainer.offsetWidth;
            const px = (percent / 100) * sliderWidth;
            progressTrack.style.width = `${percent}%`;
            progressThumb.style.left = `${px}px`;
        }
        function getPercentFromClientX(container, clientX) {
            const sliderRect = container.getBoundingClientRect();
            const offsetX = clientX - sliderRect.left;
            const sliderWidth = container.offsetWidth;
            return (offsetX / sliderWidth) * 100;
        }
        function onSliderMove(clientX) {
            if (!audioPlayer.src || isNaN(audioPlayer.duration) || audioPlayer.duration === 0) return;
            const percent = getPercentFromClientX(progressBarContainer, clientX);
            updateThumbAndProgress(percent);
            const newTime = (percent / 100) * audioPlayer.duration;
            currentTimeEl.textContent = formatTime(newTime);
        }
        function seekAudio(clientX) {
            if (!audioPlayer.src || isNaN(audioPlayer.duration) || audioPlayer.duration === 0) return;
            const percent = getPercentFromClientX(progressBarContainer, clientX);
            updateThumbAndProgress(percent);
            audioPlayer.currentTime = (percent / 100) * audioPlayer.duration;
        }

        function setupSliderEvents() {
            progressThumb.addEventListener('mousedown', (e) => {
                isSliderDragging = true;
                progressThumb.classList.add('active');
                document.body.style.cursor = 'grabbing';
            });
            document.addEventListener('mousemove', (e) => {
                if (isSliderDragging) onSliderMove(e.clientX);
            });
            document.addEventListener('mouseup', (e) => {
                if (isSliderDragging) {
                    isSliderDragging = false;
                    progressThumb.classList.remove('active');
                    document.body.style.cursor = 'default';
                    seekAudio(e.clientX);
                }
            });
            progressBarContainer.addEventListener('mousedown', (e) => {
                if (e.target !== progressThumb) seekAudio(e.clientX);
            });
        }

        // Logika Slider Volume (Tidak Berubah)
        let isVolumeSliderDragging = false;
        function updateVolumeSlider(volume) {
            const percent = volume * 100;
            const sliderWidth = volumeSliderContainer.offsetWidth;
            const px = (percent / 100) * sliderWidth;
            volumeTrack.style.width = `${percent}%`;
            volumeThumb.style.left = `${px}px`;
        }
        function setVolumeFromSlider(clientX) {
            const percent = getPercentFromClientX(volumeSliderContainer, clientX);
            const volume = Math.max(0, Math.min(100, percent)) / 100;
            audioPlayer.volume = volume;
        }
        function setupVolumeSliderEvents() {
            volumeThumb.addEventListener('mousedown', (e) => {
                isVolumeSliderDragging = true;
                volumeThumb.classList.add('active');
                document.body.style.cursor = 'grabbing';
                e.stopPropagation();
                parent.postMessage({ action: 'volume-change-start' }, '*');
            });
            document.addEventListener('mousemove', (e) => {
                if (isVolumeSliderDragging) {
                    setVolumeFromSlider(e.clientX);
                }
            });
            document.addEventListener('mouseup', (e) => {
                if (isVolumeSliderDragging) {
                    isVolumeSliderDragging = false;
                    volumeThumb.classList.remove('active');
                    document.body.style.cursor = 'default';
                    parent.postMessage({ action: 'volume-change-end' }, '*');
                }
            });
            volumeSliderContainer.addEventListener('mousedown', (e) => {
                if (e.target !== volumeThumb) {
                    setVolumeFromSlider(e.clientX);
                }
            });
        }

        function setupMusicPlayerControls() {
            playPauseBtn.addEventListener('click', () => {
                if (!audioPlayer.src) { return; }

                if (audioPlayer.paused) {
                    const currentTitle = songTitle.textContent || 'Unknown Title';
                    const currentArtist = songArtist.textContent || 'Unknown Artist';
                    const currentAlbumArt = albumArt.src;

                    const restartNotification = { action: 'show-media-notification', title: currentTitle, artist: currentArtist, albumArt: currentAlbumArt };
                    parent.postMessage(restartNotification, '*');

                    // Pastikan AudioContext di-resume jika di-suspend
                    if (audioContext && audioContext.state === 'suspended') audioContext.resume();
                    audioPlayer.play().catch(e => { console.error("[Music Player] Failed to play:", e); });

                } else {
                    audioPlayer.pause();
                }
            });
            stopBtn.addEventListener('click', () => {
                if (audioPlayer.src) {
                    audioPlayer.pause();
                    audioPlayer.currentTime = 0;
                    parent.postMessage({ action: 'stop-music-frame' }, '*');
                }
            });
            audioPlayer.addEventListener('play', () => { 
                playIcon.style.display = 'none'; pauseIcon.style.display = 'block';
                if (audioContext && audioContext.state === 'suspended') audioContext.resume();
            });
            audioPlayer.addEventListener('pause', () => { playIcon.style.display = 'block'; pauseIcon.style.display = 'none'; });
            audioPlayer.addEventListener('loadedmetadata', () => {
                durationEl.textContent = formatTime(audioPlayer.duration);
                updateThumbAndProgress(0);
            });
            audioPlayer.addEventListener('timeupdate', () => {
                if (!isSliderDragging) {
                    const percent = (audioPlayer.duration > 0) ? (audioPlayer.currentTime / audioPlayer.duration) * 100 : 0;
                    updateThumbAndProgress(percent);
                }
                currentTimeEl.textContent = formatTime(audioPlayer.currentTime);
            });
            rewindBtn.addEventListener('click', () => { if (audioPlayer.src) audioPlayer.currentTime = Math.max(0, audioPlayer.currentTime - 10); });
            forwardBtn.addEventListener('click', () => { if (audioPlayer.src) audioPlayer.currentTime = Math.min(audioPlayer.duration, audioPlayer.currentTime + 10); });
            audioPlayer.addEventListener('volumechange', () => {
                updateVolumeSlider(audioPlayer.volume);
                const percent = Math.round(audioPlayer.volume * 100);
                parent.postMessage({ action: 'show-volume-flyout', volume: percent }, '*');
            });
        }
        
        // --- Event Drop Zone Disesuaikan ---
        function handleDrop(e) {
            e.preventDefault();
            const dropZone = e.currentTarget;
            dropZone.classList.remove('drag-over');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('audio/')) playMusic(file);
        }
        musicPlayerContainer.addEventListener('dragover', (e) => {
            e.preventDefault();
            musicPlayerContainer.classList.add('drag-over');
        });
        musicPlayerContainer.addEventListener('dragleave', () => musicPlayerContainer.classList.remove('drag-over'));
        musicPlayerContainer.addEventListener('drop', handleDrop);


        // Logika window (Tidak Berubah)
        header.addEventListener('mousedown', (e) => {
            isWindowDragging = true;
            parent.postMessage({ action: 'bring-music-to-front' }, '*');
            e.preventDefault();
        });
        window.addEventListener('mousemove', (e) => {
            if (isWindowDragging) parent.postMessage({ action: 'drag-music-frame', dx: e.movementX, dy: e.movementY }, '*');
        });
        window.addEventListener('mouseup', () => isWindowDragging = false);
        closeBtn.addEventListener('click', () => parent.postMessage({ action: 'close-music-frame' }, '*'));
        minimizeBtn.addEventListener('click', () => parent.postMessage({ action: 'minimize-music-frame' }, '*'));
        maximizeBtn.addEventListener('click', () => { 
            parent.postMessage({ action: 'maximize-music-frame' }, '*');
        });

        window.addEventListener('message', (event) => {
            const { action, isDark, value, isMaximized, borderRadius } = event.data;
            const windowElement = document.querySelector('.app-window'); 

            if (action === 'stop') {
                audioPlayer.pause();
                audioPlayer.src = "";
                songTitle.textContent = 'No song playing';
                songArtist.textContent = 'Drop a music file to start';
                updateThumbAndProgress(0);
                albumArt.style.display = 'none';
                albumArt.src = '';
                albumArtPlaceholder.style.display = 'flex';
                if (audioContext && audioContext.state === 'running') audioContext.suspend(); // Hentikan AudioContext
            }
            // PENTING: Toggle kelas 'dark' pada body
            if (action === 'theme-change') document.body.classList.toggle('dark', isDark);
            if (action === 'toggle-fancy-mode') document.body.classList.toggle('fancy-mode', value);

            if (action === 'set-maximized-state') {
                if (isMaximized) {
                    maximizeBtn.title = "Restore Down";
                    maximizeBtn.innerHTML = `<svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 1H9V7H3V1ZM2 0H10V8H2V0Z" fill="currentColor"/><path d="M1 3H7V9H1V3ZM0 2H8V10H0V2Z" fill="currentColor" opacity="0.5"/></svg>`;
                    windowElement.style.borderRadius = borderRadius || '0'; 
                    header.style.cursor = 'default';
                    isWindowDragging = false;
                } else {
                    maximizeBtn.title = "Maximize";
                    maximizeBtn.innerHTML = `<svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 1V9H1V1H9ZM10 0H0V10H10V0Z" fill="currentColor"/></svg>`;
                    windowElement.style.borderRadius = '8px';
                    header.style.cursor = 'move';
                }
            }
        });

        // --- Event Listener Transisi View BARU ---
        eqBtn.addEventListener('click', () => toggleEQView(true));
        closeEqBtn.addEventListener('click', () => toggleEQView(false));


        // Inisialisasi
        initAudioContextAndEQ(); // Inisialisasi Web Audio API dan EQ
        initEQUI(); // Inisialisasi UI EQ
        setupMusicPlayerControls();
        setupSliderEvents();
        setupVolumeSliderEvents();

        window.addEventListener('load', () => {
            updateVolumeSlider(audioPlayer.volume);
            parent.postMessage({ action: 'request-settings' }, '*');
        });
    </script>
</body>

</html>